# GitHub Actions ワークフロー説明

このディレクトリには、MCUセットアップスクリプトを自動テストするためのGitHub Actionsワークフローが含まれています。

## ワークフローファイル

### 1. test-mcu-setup.yml
**基本的なテストワークフロー**
- Ubuntu 24.04でのフルインストールテスト
- Ubuntu 22.04での互換性テスト
- インストール結果の検証
- ログファイルのアップロード

**トリガー条件:**
- スクリプトファイルへの変更時
- プルリクエスト時
- 手動実行可能

### 2. test-comprehensive.yml
**包括的なテストワークフロー**
- 構文チェックと静的解析（ShellCheck）
- 複数のUbuntuバージョンでのマトリックステスト
- Dockerコンテナでのクリーン環境テスト
- 詳細な成功率レポート
- 定期実行（毎週月曜日）

**トリガー条件:**
- mainブランチへのプッシュ
- developブランチへのプッシュ
- プルリクエスト
- 定期実行（cron）
- 手動実行（デバッグオプション付き）

## テスト内容

### 🔍 静的解析
- Bashスクリプトの構文チェック
- ShellCheckによるコード品質チェック
- URLの有効性確認

### 🚀 インストールテスト
- bootstrap_mcu_prereq.shの実行
- setup_mcu_env.shの完全実行
- 各ツールのインストール確認

### ✅ 検証項目
- GCC、Git、CMake、Python3
- ARM GCC（arm-none-eabi-gcc）
- RISC-V GCC
- OpenOCD
- Arduino CLI
- PlatformIO
- Visual Studio Code

### 🐳 Dockerテスト
- Ubuntu 24.04のクリーン環境
- 完全な依存関係のテスト
- 隔離された環境での動作確認

## 実行結果の確認方法

1. **Actions タブ**
   - リポジトリの「Actions」タブを開く
   - 実行中または完了したワークフローを確認

2. **ステータスバッジ**
   - README.mdに表示されるバッジで状態を確認
   - 緑：成功、赤：失敗、黄：実行中

3. **ログの確認**
   - 各ジョブをクリックして詳細ログを表示
   - 「Artifacts」からダウンロード可能なログファイル

4. **サマリーレポート**
   - test-comprehensiveワークフローの最後に生成
   - 各テストの成功/失敗状態を表形式で表示

## トラブルシューティング

### ワークフローが実行されない
- ファイルが正しい場所にあるか確認（.github/workflows/）
- YAMLの構文エラーがないか確認
- トリガー条件を満たしているか確認

### テストが失敗する
- ログを確認して具体的なエラーメッセージを特定
- ローカルで同じコマンドを実行して再現性を確認
- 依存関係やネットワークの問題を確認

### タイムアウトエラー
- setup_mcu_env.shは30分のタイムアウト設定
- 大きなファイルのダウンロードで失敗する場合がある
- リトライ機能が正しく動作しているか確認

## カスタマイズ

### 新しいテストの追加
```yaml
- name: カスタムテスト
  run: |
    # テストコマンド
    ./your_custom_test.sh
```

### 環境変数の設定
```yaml
env:
  CUSTOM_VAR: value
```

### マトリックステストの拡張
```yaml
strategy:
  matrix:
    os: [ubuntu-20.04, ubuntu-22.04, ubuntu-24.04]
    python: [3.8, 3.9, 3.10, 3.11]
```

## ベストプラクティス

1. **小さな変更を頻繁にプッシュ**
   - 問題の早期発見が可能
   - デバッグが容易

2. **プルリクエストの活用**
   - mainブランチを保護
   - レビューとテストの自動化

3. **ログの活用**
   - 詳細なログ出力を含める
   - アーティファクトとして保存

4. **定期実行の設定**
   - 外部依存関係の変更を検出
   - 長期的な安定性の確保 